name: Run Kaggle Notebook
on:
  schedule:
    - cron: '15 */6 * * *'
  workflow_dispatch:

jobs:
  run-notebook:
    runs-on: ubuntu-latest
    
    steps:
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
      
      - name: Install Kaggle
        run: pip install kaggle
      
      - name: Configure Credentials
        run: |
          mkdir -p ~/.kaggle
          echo '{"username":"shreevathsbbhh","key":"46675a9b7dbf9ee364dccd62b33c1354"}' > ~/.kaggle/kaggle.json
          chmod 600 ~/.kaggle/kaggle.json
      
      - name: Pull and Modify Notebook
        run: |
          # Pull notebook
          kaggle kernels pull shreevathsbbhh/new-6 -p ./notebook -m
          
          cd ./notebook
          
          # Add timestamp cell to force new version
          python3 << 'EOF'
          import json
          from datetime import datetime
          
          with open('new-6.ipynb', 'r') as f:
              nb = json.load(f)
          
          # Insert timestamp cell
          nb['cells'].insert(0, {
              "cell_type": "code",
              "execution_count": None,
              "metadata": {},
              "outputs": [],
              "source": [f"# Auto-triggered at {datetime.now().isoformat()}\n", "print('Notebook started!')"]
          })
          
          with open('new-6.ipynb', 'w') as f:
              json.dump(nb, f, indent=2)
          
          print("âœ… Notebook modified")
          EOF
          
          # Recreate metadata
          cat > kernel-metadata.json << 'METADATA'
          {
            "id": "shreevathsbbhh/new-6",
            "title": "new-6",
            "code_file": "new-6.ipynb",
            "language": "python",
            "kernel_type": "notebook",
            "is_private": false,
            "enable_gpu": false,
            "enable_tpu": false,
            "enable_internet": true,
            "dataset_sources": [],
            "competition_sources": [],
            "kernel_sources": []
          }
          METADATA
          
          # Push to trigger execution
          echo "Pushing notebook to Kaggle..."
          kaggle kernels push
          
          echo "âœ… Notebook pushed! New execution should start."
          echo "ðŸ”— Check: https://www.kaggle.com/code/shreevathsbbhh/new-6"
      
      - name: Wait and Check
        run: |
          sleep 30
          kaggle kernels status shreevathsbbhh/new-6
